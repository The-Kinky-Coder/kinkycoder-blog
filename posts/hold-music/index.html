<!DOCTYPE html>
<html lang="en">

  <head>
    <script>
      (function() {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
          document.documentElement.setAttribute('data-theme', savedTheme);
        }
      })();

    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Hold Music, aka why my ears are bleeding... - The Kinky Coder</title>
    <meta name="description" content="People need to do hold music better.">

    <link rel="canonical" href="https://kinkycoder.com/posts/hold-music/">

    <meta property="og:type" content="article">
    <meta property="og:url" content="https://kinkycoder.com/posts/hold-music/">
    <meta property="og:site_name" content="The Kinky Coder">
    <meta property="og:title" content="Hold Music, aka why my ears are bleeding...">
    <meta property="og:description" content="People need to do hold music better.">
    <meta property="og:image" content="https://kinkycoder.com/css/default-share-image.jpg">

    <meta name="bluesky:creator" content="@kinkycoder.com">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@thekinkycoder">
    <meta name="twitter:title" content="Hold Music, aka why my ears are bleeding...">
    <meta name="twitter:description" content="People need to do hold music better.">
    <meta name="twitter:image" content="https://kinkycoder.com/css/default-share-image.jpg">

    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "headline": "Hold Music, aka why my ears are bleeding...",
        "image": [
          "https://kinkycoder.com/css/default-share-image.jpg"
        ],
        "datePublished": "2026-01-28T15:00:00.000Z",
        "dateModified": "2026-01-28T15:00:00.000Z",
        "inLanguage": "en-US",
        "author": [{
          "@type": "Person",
          "name": "Kinky Coder",
          "url": "https://kinkycoder.com",
          "sameAs": [
            "https://twitter.com/thekinkycoder",
            "https://bsky.app/profile/kinkycoder.com"
          ]
        }],
        "publisher": {
          "@type": "Person",
          "name": "Kinky Coder",
          "url": "https://kinkycoder.com",
          "sameAs": [
            "https://twitter.com/thekinkycoder",
            "https://bsky.app/profile/kinkycoder.com"
          ]
        },
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "https://kinkycoder.com/posts/hold-music/"
        },
        "description": "People need to do hold music better.",
        "keywords": "post, rant",
        "articleSection": "Blog",
        "breadcrumb": {
          "@type": "BreadcrumbList",
          "itemListElement": [{
              "@type": "ListItem",
              "position": 1,
              "name": "Home",
              "item": "https://kinkycoder.com"
            },
            {
              "@type": "ListItem",
              "position": 2,
              "name": "Hold Music, aka why my ears are bleeding...",
              "item": "https://kinkycoder.com/posts/hold-music/"
            }
          ]
        }
      }

    </script>

    <style>
      :root {
        --bg-primary: #ffffff;
        --bg-secondary: #f8f9fa;
        --text-primary: #1a1a1a;
        --text-secondary: #495057;
        --accent: #0066cc;
        --accent-hover: #0052a3;
        --border: #dee2e6;
        --shadow: rgba(0, 0, 0, 0.1);
        --header-bg: rgba(248, 249, 250, 0.9);
      }

      /* Dark Theme - System Preference */
      @media (prefers-color-scheme: dark) {
        :root:not([data-theme]) {
          --bg-primary: #1a1a1a;
          --bg-secondary: #2d2d2d;
          --text-primary: #e4e4e4;
          --text-secondary: #a0a0a0;
          --accent: #4d9fff;
          --accent-hover: #6db0ff;
          --border: #404040;
          --shadow: rgba(0, 0, 0, 0.3);
          --header-bg: rgba(45, 45, 45, 0.9);
        }
      }

      /* Dark Theme - Explicit */
      :root[data-theme="dark"] {
        --bg-primary: #1a1a1a;
        --bg-secondary: #2d2d2d;
        --text-primary: #e4e4e4;
        --text-secondary: #a0a0a0;
        --accent: #4d9fff;
        --accent-hover: #6db0ff;
        --border: #404040;
        --shadow: rgba(0, 0, 0, 0.3);
        --header-bg: rgba(45, 45, 45, 0.9);
      }

      /* High Contrast Theme */
      :root[data-theme="high-contrast"] {
        --bg-primary: #000000;
        --bg-secondary: #000000;
        --text-primary: #ffffff;
        --text-secondary: #ffff00;
        --accent: #ffff00;
        --accent-hover: #ffffff;
        --border: #ffffff;
        --shadow: none;
        --header-bg: #000000;
      }

      /* Explicit Light Theme (re-enforce default if needed over system dark) */
      :root[data-theme="light"] {
        --bg-primary: #ffffff;
        --bg-secondary: #f8f9fa;
        --text-primary: #1a1a1a;
        --text-secondary: #495057;
        --accent: #0066cc;
        --accent-hover: #0052a3;
        --border: #dee2e6;
        --shadow: rgba(0, 0, 0, 0.1);
        --header-bg: rgba(248, 249, 250, 0.9);
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      *:focus-visible {
        outline: 3px solid var(--accent);
        outline-offset: 2px;
        border-radius: 2px;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        line-height: 1.6;
        color: var(--text-primary);
        background-color: var(--bg-primary);
        transition: background-color 0.3s ease, color 0.3s ease;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
        padding: 0 20px;
      }

      .container p {
        margin-bottom: 1rem;
      }

      /* Header */
      .site-header {
        background-color: var(--header-bg);
        border-bottom: 1px solid var(--border);
        padding: 0.5rem 0;
        position: sticky;
        top: 0;
        z-index: 100;
        backdrop-filter: blur(10px);
      }

      .site-header nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .logo {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--text-primary);
        text-decoration: none;
      }

      .nav-links {
        display: flex;
        gap: 2rem;
      }

      .nav-links a {
        color: var(--text-secondary);
        text-decoration: none;
        font-weight: 500;
        transition: color 0.2s ease;
      }

      .nav-links a:hover {
        color: var(--accent);
      }

      .theme-switcher-wrapper {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .theme-icon {
        color: var(--text-secondary);
        /* Ensure icon scales with text if needed, though fixed width/height is set on SVG */
      }

      .theme-selector {
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        border: 1px solid var(--border);
        background-color: var(--bg-primary);
        color: var(--text-primary);
        font-family: inherit;
        font-size: 0.9rem;
        cursor: pointer;
      }

      .theme-selector:focus-visible {
        outline: 3px solid var(--accent);
      }

      /* Main content */
      main {
        padding: 3rem 0;
        flex: 1;
      }

      /* Hero section */
      .hero {
        text-align: center;
        padding-top: 1rem;
      }

      .hero h1 {
        font-size: 2.5rem;
        margin-bottom: 1rem;
        color: var(--text-primary);
      }

      .hero p {
        font-size: 1.25rem;
        color: var(--text-secondary);
      }

      /* Posts list */
      .posts-list h2 {
        font-size: 1.5rem;
        margin-bottom: 0.5rem;
        color: var(--text-primary);
      }

      .post-preview {
        padding: 2rem;
        margin-bottom: 2rem;
        background-color: var(--bg-secondary);
        border-radius: 8px;
        border: 1px solid var(--border);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      .post-preview:hover {
        box-shadow: 0 4px 12px var(--shadow);
      }

      .post-preview h3 {
        margin-bottom: 0.5rem;
      }

      .post-preview h3 a {
        color: var(--text-primary);
        text-decoration: none;
        font-size: 1.25rem;
      }

      .post-preview h3 a:hover {
        color: var(--accent);
      }

      .post-preview time {
        color: var(--text-secondary);
        font-size: 0.9rem;
        display: block;
        margin-bottom: 1rem;
      }

      .post-preview p {
        color: var(--text-secondary);
        margin-bottom: 1rem;
      }

      .read-more {
        color: var(--accent);
        text-decoration: none;
        font-weight: 500;
        transition: color 0.2s ease;
      }

      .read-more:hover {
        color: var(--accent-hover);
      }

      /* Post page */
      .post {
        max-width: 700px;
        margin: 0 auto;
      }

      .post-header {
        margin-top: 0.5rem;
        /* margin-bottom: 2rem; */
        padding-bottom: 0.5rem;
        border-bottom: 1px solid var(--border);
      }

      .post-header h1 {
        font-size: 2.5rem;
        margin-bottom: 0.5rem;
        line-height: 1.2;
      }

      .post-header time {
        color: var(--text-secondary);
        font-size: 0.95rem;
      }

      .post-content {
        font-size: 1.1rem;
        line-height: 1.8;
      }

      .post-content h1,
      .post-content h2,
      .post-content h3 {
        margin-top: 2rem;
        margin-bottom: 1rem;
        color: var(--text-primary);
      }

      .post-content h2 {
        font-size: 1.5rem;
      }

      .post-content h3 {
        font-size: 1.25rem;
      }

      .post-content p {
        margin-bottom: 1.5rem;
      }

      .post-content a {
        color: var(--accent);
        text-decoration: none;
      }

      .post-content a:hover {
        text-decoration: underline;
      }

      .post-content img {
        max-width: 100%;
        height: auto;
        border-radius: 8px;
        margin: 2rem 0;
      }

      .post-content ul,
      .post-content ol {
        margin-bottom: 1.5rem;
        padding-left: 2rem;
      }

      .post-content li {
        margin-bottom: 0.5rem;
      }

      .post-content code {
        background-color: var(--bg-secondary);
        padding: 0.2rem 0.4rem;
        border-radius: 3px;
        font-size: 0.9em;
        font-family: 'Courier New', monospace;
      }

      .post-content pre {
        background-color: var(--bg-secondary);
        padding: 1.5rem;
        border-radius: 8px;
        overflow-x: auto;
        margin-bottom: 1.5rem;
      }

      .post-content pre code {
        background-color: transparent;
        padding: 0;
      }

      .post-content p:has(+ blockquote) {
        margin-bottom: 0.5rem;
      }

      .post-content blockquote {
        background-color: var(--bg-secondary);
        border-left: 4px solid var(--accent);
        padding: 1.5rem;
        border-radius: 8px;
        color: var(--text-secondary);
        line-height: 1.5rem;
        margin-bottom: 1rem;
      }

      .post-content blockquote p {
        margin-bottom: 1rem;
      }

      .post-content blockquote p:last-child {
        margin-bottom: 0;
      }

      /* Footer */
      .site-footer {
        background-color: var(--bg-secondary);
        border-top: 1px solid var(--border);
        padding-top: 0.5rem;
        text-align: center;
      }

      .site-footer p {
        color: var(--text-secondary);
        font-size: 0.9rem;
      }

      /* Mobile responsive */
      @media (max-width: 768px) {
        .site-header {
          position: static;
        }

        .site-header nav {
          flex-direction: column;
          gap: 1rem;
        }

        .nav-links {
          width: 100%;
          justify-content: center;
          flex-wrap: wrap;
          gap: 1rem;
        }

        .hero h1 {
          font-size: 2rem;
        }

        .hero p {
          font-size: 1.1rem;
        }

        .post-header h1 {
          font-size: 2rem;
        }

        .post-content {
          font-size: 1rem;
        }

        .nav-links {
          gap: 1rem;
        }

        .post-preview {
          padding: 1.5rem;
        }
      }

      /* Breadcrumbs */
      .breadcrumb {
        list-style: none;
        padding: 0;
        margin-bottom: 1rem;
        font-size: 0.9rem;
      }

      .breadcrumb li {
        display: inline;
      }

      .breadcrumb li:not(:last-child)::after {
        content: " > ";
        color: var(--text-secondary);
      }

      .breadcrumb a {
        color: var(--accent);
        text-decoration: none;
      }

      .breadcrumb a:hover {
        text-decoration: underline;
      }

      /* Audio Player Styles */
      .audio-player {
        background: var(--bg-secondary, #f8f9fa);
        border: 1px solid var(--border, #dee2e6);
        border-radius: 8px;
        padding: 1rem;
        display: flex;
        align-items: center;
        gap: 1.25rem;
        margin: 2rem 0;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      }

      .play-btn {
        background: #f50;
        color: white;
        border: none;
        border-radius: 50%;
        width: 56px;
        height: 56px;
        flex-shrink: 0;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
      }

      .play-btn:hover {
        transform: scale(1.05);
        background: #ff6a22;
        box-shadow: 0 4px 12px rgba(255, 85, 0, 0.3);
      }

      .waveform-container {
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
        min-width: 0;
      }

      .track-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.75rem;
        color: var(--text-secondary, #6c757d);
        margin-top: 8px;
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      }

      .filename {
        max-width: 30%;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .download-link {
        color: var(--text-secondary, #6c757d);
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 4px;
        transition: color 0.2s ease;
        font-size: 0.75rem;
      }

      .download-link:hover {
        color: var(--accent, #0066cc);
        text-decoration: underline;
      }

      .download-icon {
        width: 14px;
        height: 14px;
      }

      .volume-control {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-left: 0.5rem;
      }

      .volume-btn {
        background: none;
        border: none;
        color: var(--text-secondary, #6c757d);
        cursor: pointer;
        padding: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: color 0.2s ease;
      }

      .volume-btn:hover {
        color: var(--text-primary, #1a1a1a);
      }

      .volume-slider {
        appearance: none;
        -webkit-appearance: none;
        width: 80px;
        height: 4px;
        background: var(--border, #dee2e6);
        border-radius: 2px;
        outline: none;
        transition: background 0.2s;
      }

      .volume-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 12px;
        height: 12px;
        background: var(--text-secondary, #6c757d);
        border-radius: 50%;
        cursor: pointer;
        transition: transform 0.1s, background 0.2s;
      }

      .volume-slider::-moz-range-thumb {
        width: 12px;
        height: 12px;
        background: var(--text-secondary, #6c757d);
        border: none;
        border-radius: 50%;
        cursor: pointer;
        transition: transform 0.1s, background 0.2s;
      }

      .volume-slider::-webkit-slider-thumb:hover {
        transform: scale(1.2);
        background: var(--accent, #0066cc);
      }

      .volume-slider::-moz-range-thumb:hover {
        transform: scale(1.2);
        background: var(--accent, #0066cc);
      }

    </style>

  </head>

  <body>
    <header class="site-header">
      <div class="container">
        <nav>
          <a href="/" class="logo">The Kinky Coder</a>
          <div class="nav-links">
            <a href="/">Home</a>
            <a href="/about">About</a>
            <div class="theme-switcher-wrapper">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="theme-icon" aria-hidden="true">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M12 2a10 10 0 0 1 0 20z" fill="currentColor" stroke="none"></path>
              </svg>
              <select id="theme-selector" class="theme-selector" aria-label="Select Theme">
                <option value="system">System</option>
                <option value="light">Light</option>
                <option value="dark">Dark</option>
                <option value="high-contrast">High Contrast</option>
              </select>
            </div>
          </div>
        </nav>
      </div>
    </header>
    <main class="container">
      <article class="post">
        <header class="post-header">
          <h1>Hold Music, aka why my ears are bleeding...</h1>
          <time datetime="2026-01-28T15:00:00.000Z">January 28, 2026</time>
        </header>

        <article class="post-content">
          <h2>If you are implementing a <a href="https://en.wikipedia.org/wiki/Music_on_hold">Music on Hold</a> system. Stop! Just stop!</h2>
          <p>Every time I have to call a company because of some niche issue has popped up that can't be fixed via chat/email/support ticket I always seem to come away from the call frustrated. Even if I accomplished that I set out to achieve. It's often not the call scripts talk takers have to go through (I get it, those script resolve like 90-95% of the issues callers face), nor the amount of time you're sitting on hold (ok it kinda is, but it's only a side effect of the problem) as I'm fortunate enough where I can just put the call on speakerphone, put the phone on its dock, and carry on with what I am doing until the call is answered.</p>
          <p>No, that really drives me up the wall with these calls is the hold music system deployed on most of these systems. The music chosen tends to have a too wide a dynamic range to be transmitted over a traditional phone line and still sound good!</p>
          <p>Back in the day of the true analog phone line it wasn't as bad, even with the analog compression phone companies used to squeeze more calls over a single trunk. Then along came mobile phones, which compressed the bandwidth per call even more. But why stop there when you can use G.729 and squeeze a call down to as low as 6.4kbits/s!</p>
          <p>Now, compressing a line so much is just about bearable for voice only, but as soon as you pipe anything other than voice down that line it's going to sound like shit!</p>
          <p>Today's call wasn't as bad as G.729. Analysing the hold music (yes, I called back and recorded the hold music, No I'm not weird! Your weird!!!) it cuts off ~3.4kHz, so standard PSTN/G7.11 (an 64 kbit/s bitrate) but even then if you use heavily compress the audio it just sounds like shit. Here is a sample of the hold music I was subjected too</p>
          <div id="audio-ld9a07" class="audio-player" data-url="/audio/CallRecording.m4a">
            <button id="audio-ld9a07-btn" class="play-btn" aria-label="Play/Pause">
              <svg id="audio-ld9a07-play" viewBox="0 0 24 24" fill="currentColor" width="56" height="56">
                <path d="M8 5v14l11-7z" />
              </svg>
              <svg id="audio-ld9a07-pause" viewBox="0 0 24 24" fill="currentColor" width="56" height="56" style="display: none;">
                <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z" />
              </svg>
            </button>
            <div class="waveform-container">
              <div id="audio-ld9a07-waveform"></div>
              <div class="track-info">
                <span class="filename" title="CallRecording.m4a">CallRecording.m4a</span>
                <a href="/audio/CallRecording.m4a" download class="download-link">
                  <svg class="download-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                    <polyline points="7 10 12 15 17 10" />
                    <line x1="12" y1="15" x2="12" y2="3" />
                  </svg>
                  Download
                </a>
                <span class="time"><span id="audio-ld9a07-current">0:00</span> / <span id="audio-ld9a07-total">0:00</span></span>
                <div class="volume-control">
                  <button id="audio-ld9a07-mute" class="volume-btn" aria-label="Mute/Unmute" title="Mute/Unmute">
                    <svg id="audio-ld9a07-vol-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="16" height="16">
                      <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                      <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                    </svg>
                    <svg id="audio-ld9a07-mute-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="16" height="16" style="display: none;">
                      <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                      <line x1="23" y1="9" x2="17" y2="15"></line>
                      <line x1="17" y1="9" x2="23" y2="15"></line>
                    </svg>
                  </button>
                  <input type="range" id="audio-ld9a07-volume" class="volume-slider" min="0" max="1" step="0.05" value="1" aria-label="Volume">
                </div>
              </div>
            </div>
          </div>
          <p>I <em>think</em> that's supposed to be <a href="https://www.youtube.com/watch?v=N7xn5zeJ4D4" target="_blank" rel="noopener">Opus No. 1 by Tim Carleton</a> but the recording just butchers it so much I dunno what's real anymore.</p>
          <p>If you are ever setting up a PBX and putting hold music on the system, For the love of the Emperor, listen to how the hold music sounds on a real call before inflicting that onto others! A good baseline should be if you can manage to listen to it, from a phones' loudspeaker, for longer than an hour without having the urge to yeet the phone into next week, you are on the right track on tuning everything to sound about right. But here's the thing, We leave in the world of cheap PBX systems, heck you can spin up FreePBX for the cost of just learning the thing! We live in a world where we can give callers options, hell they are imposed on them enough in the form of menu tree when they first call in, why not use the same tech to offer the caller the option to select which hold music they will have to listen too? Why not give them the option to turn it off completely and just have an occasional beep to let the caller know they are still on the call. Hell you will get extra brownie points if you tie that in with caller line identification and save the callers' preference for next time they have to call in.</p>
          <p>We can do better! Take some pride! PBX's should be like good VFX. If the caller leaves the call not noticing the PBX system, it on the right track.</p>
          <p>Anyway, I'm gonna stop venting now, I've got to help my step-brother out in 30 mins dealing with a screw-up Vermin Media did (I know, I'm as shocked as you are), so I have to prep myself for another bombardment of hold music! Wish me luck...</p>
          <p>EDIT: Yeah I know, I'm pulling a <a href="https://www.youtube.com/watch?v=w2A8q3XIhu0" target="_blank" rel="noopener">Tom Scott</a> (Actually Tom says it better than I did). I just needed to vent OK!</p>

        </article>
      </article>
    </main>
    <footer class="site-footer">
      <div class="container">
        <p>&copy; 2026 The Kinky Coder. All rights reserved.</p>
      </div>
    </footer>

    <script type="module">
      import WaveSurfer from '/js/wavesurfer.esm.js';
      // We wrap everything in a function to avoid global scope pollution
      function initAudioPlayers() {
        const players = document.querySelectorAll('.audio-player');
        players.forEach(player => {
          // Check if we already set this one up to prevent duplicates
          if (player.dataset.initialized) return;
          player.dataset.initialized = "true";
          const url = player.dataset.url;
          const id = player.id; // Grab the ID generated by the shortcode
          // Scoped selectors: We find elements relative to the document using the unique ID
          const containerId = `#${id}-waveform`;
          const playPauseBtn = document.getElementById(`${id}-btn`);
          const playIcon = document.getElementById(`${id}-play`);
          const pauseIcon = document.getElementById(`${id}-pause`);
          const currentTime = document.getElementById(`${id}-current`);
          const totalDuration = document.getElementById(`${id}-total`);
          const volumeSlider = document.getElementById(`${id}-volume`);
          const muteBtn = document.getElementById(`${id}-mute`);
          const volIcon = document.getElementById(`${id}-vol-icon`);
          const muteIcon = document.getElementById(`${id}-mute-icon`);
          const isDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
          const waveColor = isDarkMode ? 'rgba(255, 255, 255, 0.3)' : 'rgba(0, 0, 0, 0.2)';
          const commonOptions = {
            container: containerId,
            waveColor: waveColor,
            progressColor: '#f50',
            url: url,
            height: 60,
            barWidth: 3,
            barGap: 2,
            barRadius: 3,
            cursorColor: '#f50',
            cursorWidth: 2,
            dragToSeek: true,
            normalize: true,
          };
          let wavesurfer;
          let lastVolume = 1;

          function createWaveSurfer(extraOptions = {}) {
            const options = {
              ...commonOptions,
              ...extraOptions
            };
            wavesurfer = WaveSurfer.create(options);
            playPauseBtn.addEventListener('click', () => wavesurfer.playPause());
            wavesurfer.on('play', () => {
              playIcon.style.display = 'none';
              pauseIcon.style.display = 'block';
            });
            wavesurfer.on('pause', () => {
              playIcon.style.display = 'block';
              pauseIcon.style.display = 'none';
            });
            // Volume Logic
            const updateSlider = (value) => {
              const percentage = value * 100;
              volumeSlider.style.background = `linear-gradient(to right, #f50 ${percentage}%, var(--border, #dee2e6) ${percentage}%)`;
            };
            updateSlider(volumeSlider.value);
            volumeSlider.addEventListener('input', (e) => {
              const value = parseFloat(e.target.value);
              wavesurfer.setVolume(value);
              lastVolume = value;
              updateMuteIcon(value === 0);
              updateSlider(value);
            });
            muteBtn.addEventListener('click', () => {
              const currentVolume = wavesurfer.getVolume();
              if (currentVolume > 0) {
                lastVolume = currentVolume;
                wavesurfer.setVolume(0);
                volumeSlider.value = 0;
                updateMuteIcon(true);
                updateSlider(0);
              } else {
                const newVolume = lastVolume || 1;
                wavesurfer.setVolume(newVolume);
                volumeSlider.value = newVolume;
                updateMuteIcon(false);
                updateSlider(newVolume);
              }
            });

            function updateMuteIcon(isMuted) {
              if (isMuted) {
                volIcon.style.display = 'none';
                muteIcon.style.display = 'block';
              } else {
                volIcon.style.display = 'block';
                muteIcon.style.display = 'none';
              }
            }
            const formatTime = (seconds) => {
              const minutes = Math.floor(seconds / 60);
              const secondsRemainder = Math.floor(seconds % 60);
              const paddedSeconds = secondsRemainder < 10 ? `0${secondsRemainder}` : secondsRemainder;
              return `${minutes}:${paddedSeconds}`;
            };
            wavesurfer.on('decode', (duration) => totalDuration.textContent = formatTime(duration));
            wavesurfer.on('ready', (duration) => totalDuration.textContent = formatTime(duration));
            wavesurfer.on('timeupdate', (currentTimeSeconds) => currentTime.textContent = formatTime(currentTimeSeconds));
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
              wavesurfer.setOptions({
                waveColor: event.matches ? 'rgba(255, 255, 255, 0.3)' : 'rgba(0, 0, 0, 0.2)'
              });
            });
          }
          // Try to load peaks
          const jsonUrl = url.replace(/\.[^/.]+$/, ".json");
          fetch(jsonUrl)
            .then(response => {
              if (!response.ok) throw new Error('No peaks');
              return response.json();
            })
            .then(data => {
              if (data && data.data) {
                createWaveSurfer({
                  peaks: [data.data]
                });
              } else {
                createWaveSurfer();
              }
            })
            .catch(() => {
              createWaveSurfer();
            });
        });
      }
      // Init when DOM is ready
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initAudioPlayers);
      } else {
        initAudioPlayers();
      }

    </script>

    <script>
      const themeSelector = document.getElementById('theme-selector');
      const savedTheme = localStorage.getItem('theme');
      // Set initial value
      if (savedTheme) {
        themeSelector.value = savedTheme;
      } else {
        themeSelector.value = 'system';
      }
      themeSelector.addEventListener('change', (e) => {
        const theme = e.target.value;
        if (theme === 'system') {
          localStorage.removeItem('theme');
          document.documentElement.removeAttribute('data-theme');
        } else {
          localStorage.setItem('theme', theme);
          document.documentElement.setAttribute('data-theme', theme);
        }
      });

    </script>
  </body>

</html>
